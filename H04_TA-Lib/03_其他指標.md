# å…¶ä»–æŒ‡æ¨™


## MACD

_æŒ‡æ•¸å¹³æ»‘ç§»å‹•å¹³å‡ç·šï¼ŒMoving Average Convergence Divergence, MACD_

1. ç”¨æ–¼åˆ¤æ–·å¸‚å ´çš„å¤šç©ºè¶¨å‹¢è®ŠåŒ–ï¼Œçµ„æˆåŒ…å« MACD ç·š `çŸ­æœŸ EMA - é•·æœŸ EMA`ï¼ŒSignal ç·š MACD çš„ `9 å¤© EMA`ï¼ŒMACD æŸ±ç‹€åœ– `MACD ç·š - Signal ç·š` åæ˜ å¸‚å ´å‹•èƒ½è®ŠåŒ–ã€‚

2. ä»£ç¢¼ã€‚

```python
import pandas as pd
import numpy as np
import talib
import os

# è¨­å®šæ–‡ä»¶è·¯å¾‘
input_file = "data/è‚¡å¸‚è³‡æ–™_20240101-20250516.xlsx"
output_file = "data/è‚¡å¸‚è³‡æ–™_MACD.xlsx"

# ç¢ºä¿æ–‡ä»¶å­˜åœ¨
if not os.path.exists(input_file):
    print(f"éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°æª”æ¡ˆ {input_file}")
else:
    print(f"è®€å–æ–‡ä»¶ï¼š{input_file}")

    # è®€å– Excel æª”æ¡ˆ
    df = pd.read_excel(input_file)

    # ç¢ºä¿æ¬„ä½åç¨±æ­£ç¢º
    if not {"High", "Low", "Close"}.issubset(df.columns):
        print("éŒ¯èª¤ï¼šExcel æ–‡ä»¶ç¼ºå°‘å¿…è¦çš„æ¬„ä½ (High, Low, Close)")
    else:
        # è½‰æ›ç‚º NumPy é™£åˆ—
        high = df["High"].values.astype(np.float64)
        low = df["Low"].values.astype(np.float64)
        close = df["Close"].values.astype(np.float64)

        # è¨ˆç®— MACD æŒ‡æ¨™
        df["MACD"], df["Signal"], df["MACD_Hist"] = talib.MACD(
            close, fastperiod=12, slowperiod=26, signalperiod=9
        )

        # é¡¯ç¤ºæœ€å¾Œ 10 ç­†æ•¸æ“š
        print(df.tail(10))

        # å„²å­˜çµæœ
        df.to_excel(output_file, index=False)
        print(f"MACD è¨ˆç®—çµæœå·²å„²å­˜åˆ° {output_file}")
```

3. æ·»åŠ è£½åœ–ï¼Œå…¶ä¸­ `ç¶ è‰²` çš„ç·šæ¢æ˜¯ `MACD æŸ±ç‹€åœ–ï¼ˆHistogramï¼‰`ï¼Œå®ƒæ˜¯ç”¨ `plt.bar()` ç¹ªè£½çš„ï¼Œè€Œåœ–ä¾‹é è¨­åªæœƒé¡¯ç¤º `plt.plot()` ç¹ªè£½çš„ç·šæ¢ï¼Œä¸æœƒè‡ªå‹•åŠ å…¥ `plt.bar()` çš„æŸ±ç‹€åœ–ã€‚

```python
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
import numpy as np
import talib

# ä½¿ç”¨ PingFang HK ä½œç‚ºå­—é«”ï¼Œç¢ºä¿ä¸æœƒç™¼ç”Ÿäº‚ç¢¼
plt.rcParams["font.family"] = "PingFang HK"
# é¿å…è² è™Ÿè®Šæˆäº‚ç¢¼
plt.rcParams["axes.unicode_minus"] = False

if not {"High", "Low", "Close"}.issubset(df.columns):
    print("éŒ¯èª¤ï¼šExcel æ–‡ä»¶ç¼ºå°‘å¿…è¦çš„æ¬„ä½ (High, Low, Close)")
else:
    # è½‰æ›ç‚º NumPy é™£åˆ—
    high = df["High"].values.astype(np.float64)
    low = df["Low"].values.astype(np.float64)
    close = df["Close"].values.astype(np.float64)

    # è¨ˆç®— MACD æŒ‡æ¨™
    df["MACD"], df["Signal"], df["MACD_Hist"] = talib.MACD(
        close, fastperiod=12, slowperiod=26, signalperiod=9
    )

    # ç¹ªè£½ MACD åœ–è¡¨
    plt.figure(figsize=(12, 6))

    # ç¹ªè£½ MACD å’Œ Signal ç·š
    plt.plot(df.index, df["MACD"], label="MACD", color="blue")
    plt.plot(df.index, df["Signal"], label="Signal", color="red")

    # ç¹ªè£½ MACD æŸ±ç‹€åœ–
    plt.bar(df.index, df["MACD_Hist"], color=np.where(df["MACD_Hist"] >= 0, "green", "red"), alpha=0.5)

    # è¨­å®šæ¨™é¡Œå’Œåœ–ä¾‹
    plt.title("MACD æŒ‡æ¨™åˆ†æ", fontsize=14)
    plt.xlabel("æ™‚é–“", fontsize=12)
    plt.ylabel("MACD å€¼", fontsize=12)
    plt.legend()
    plt.grid()

    # é¡¯ç¤ºåœ–è¡¨
    plt.show()
```

![](images/img_07.png)

4. æ·»åŠ ç¶ å…¥ã€‚

```python
import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
import numpy as np
import talib
# æ‰‹å‹•æ·»åŠ  "ç¶ è‰²" æ¨™è¨»
from matplotlib.lines import Line2D

# ä½¿ç”¨ PingFang HK ä½œç‚ºå­—é«”ï¼Œç¢ºä¿ä¸æœƒç™¼ç”Ÿäº‚ç¢¼
plt.rcParams["font.family"] = "PingFang HK"
# é¿å…è² è™Ÿè®Šæˆäº‚ç¢¼
plt.rcParams["axes.unicode_minus"] = False

if not {"High", "Low", "Close"}.issubset(df.columns):
    print("éŒ¯èª¤ï¼šExcel æ–‡ä»¶ç¼ºå°‘å¿…è¦çš„æ¬„ä½ (High, Low, Close)")
else:
    # è½‰æ›ç‚º NumPy é™£åˆ—
    high = df["High"].values.astype(np.float64)
    low = df["Low"].values.astype(np.float64)
    close = df["Close"].values.astype(np.float64)

    # è¨ˆç®— MACD æŒ‡æ¨™
    df["MACD"], df["Signal"], df["MACD_Hist"] = talib.MACD(
        close, fastperiod=12, slowperiod=26, signalperiod=9
    )

    # ç¹ªè£½ MACD åœ–è¡¨
    plt.figure(figsize=(12, 6))

    # ç¹ªè£½ MACD å’Œ Signal ç·š
    plt.plot(df.index, df["MACD"], label="MACD", color="blue")
    plt.plot(df.index, df["Signal"], label="Signal", color="red")

    # ç¹ªè£½ MACD æŸ±ç‹€åœ–
    plt.bar(df.index, df["MACD_Hist"], color=np.where(df["MACD_Hist"] >= 0, "green", "red"), alpha=0.5)

    # è¨­å®šæ¨™é¡Œå’Œåœ–ä¾‹
    plt.title("MACD æŒ‡æ¨™åˆ†æ", fontsize=14)
    plt.xlabel("æ™‚é–“", fontsize=12)
    plt.ylabel("MACD å€¼", fontsize=12)
    # plt.legend()

    legend_elements = [
        Line2D([0], [0], color="blue", lw=2, label="MACD"),
        Line2D([0], [0], color="red", lw=2, label="Signal"),
        # ç¶ è‰²æ¨™è¨»
        Line2D([0], [0], color="green", lw=4, label="MACD Histogram")
    ]

    plt.legend(handles=legend_elements)
    plt.grid()

    # é¡¯ç¤ºåœ–è¡¨
    plt.show()
```


## 2ï¸âƒ£ ATR å¹³å‡çœŸå¯¦æ³¢å‹•ç¯„åœ
ğŸ“Œ å¹³å‡çœŸå¯¦ç¯„åœï¼ˆAverage True Range, ATRï¼‰
- ç”¨é€”ï¼šè¡¡é‡å¸‚å ´æ³¢å‹•ç¨‹åº¦ã€‚
- è¨ˆç®—æ–¹å¼ï¼š
  - ATR = `éå» N å¤©çš„ TRï¼ˆTrue Rangeï¼‰ çš„å¹³å‡å€¼`
  - TR = `max(ç•¶æ—¥é«˜é» - ç•¶æ—¥ä½é», |ç•¶æ—¥é«˜é» - å‰ä¸€æ—¥æ”¶ç›¤åƒ¹|, |ç•¶æ—¥ä½é» - å‰ä¸€æ—¥æ”¶ç›¤åƒ¹|)`

### ğŸ”¹ Python ä»£ç¢¼
```python
# è½‰æ›æ•¸æ“šæ ¼å¼
high = df["High"].values.astype(np.float64)
low = df["Low"].values.astype(np.float64)
close = df["Close"].values.astype(np.float64)

# è¨ˆç®— ATR
df["ATR"] = talib.ATR(high, low, close, timeperiod=14)

# å„²å­˜çµæœ
output_file = "data/è‚¡å¸‚è³‡æ–™_ATR.xlsx"
df.to_excel(output_file, index=False)
print(f"âœ… ATR è¨ˆç®—çµæœå·²å„²å­˜åˆ° {output_file}")
```

## 3ï¸âƒ£ CCI å•†å“é€šé“æŒ‡æ¨™
ğŸ“Œ å•†å“é€šé“æŒ‡æ•¸ï¼ˆCommodity Channel Index, CCIï¼‰
- ç”¨é€”ï¼šè¡¡é‡åƒ¹æ ¼èˆ‡å…¶çµ±è¨ˆå¹³å‡å€¼çš„åé›¢ç¨‹åº¦ï¼Œåˆ¤æ–·åƒ¹æ ¼è¶…è²·æˆ–è¶…è³£ã€‚
- è¨ˆç®—æ–¹å¼ï¼š
  - CCI = `(TP - SMA(TP, N)) / (0.015 * Mean Deviation)`
  - TPï¼ˆTypical Priceï¼‰= `(é«˜åƒ¹ + ä½åƒ¹ + æ”¶ç›¤åƒ¹) / 3`
  - SMA ç‚º TP çš„ N æ—¥å‡ç·š
  - Mean Deviation = `(TP - SMA) / N`

### ğŸ”¹ Python ä»£ç¢¼
```python
# è¨ˆç®— CCI
df["CCI"] = talib.CCI(high, low, close, timeperiod=14)

# å„²å­˜çµæœ
output_file = "data/è‚¡å¸‚è³‡æ–™_CCI.xlsx"
df.to_excel(output_file, index=False)
print(f"âœ… CCI è¨ˆç®—çµæœå·²å„²å­˜åˆ° {output_file}")
```

## 4ï¸âƒ£ Williams %R æŒ‡æ¨™
ğŸ“Œ å¨å»‰æŒ‡æ¨™ï¼ˆWilliams %Rï¼‰
- ç”¨é€”ï¼šåˆ¤æ–·å¸‚å ´æ˜¯å¦è¶…è²·æˆ–è¶…è³£ã€‚
- è¨ˆç®—æ–¹å¼ï¼š
  - %R = `(Hâ‚™ - C) / (Hâ‚™ - Lâ‚™) * -100`
  - Hâ‚™ï¼šéå» n å¤©çš„æœ€é«˜åƒ¹
  - Lâ‚™ï¼šéå» n å¤©çš„æœ€ä½åƒ¹
  - Cï¼šç•¶æ—¥æ”¶ç›¤åƒ¹

### ğŸ”¹ Python ä»£ç¢¼
```python
# è¨ˆç®— Williams %R
df["Williams %R"] = talib.WILLR(high, low, close, timeperiod=14)

# å„²å­˜çµæœ
output_file = "data/è‚¡å¸‚è³‡æ–™_WilliamsR.xlsx"
df.to_excel(output_file, index=False)
print(f"âœ… Williams %R è¨ˆç®—çµæœå·²å„²å­˜åˆ° {output_file}")
```

## 5ï¸âƒ£ OBV æˆäº¤é‡æŒ‡æ¨™
ğŸ“Œ æˆäº¤é‡æŒ‡æ¨™ï¼ˆOn-Balance Volume, OBVï¼‰
- ç”¨é€”ï¼šè¡¡é‡è³‡é‡‘æµå‘ã€‚
- è¨ˆç®—æ–¹å¼ï¼š
  - è‹¥ä»Šæ—¥æ”¶ç›¤åƒ¹ é«˜æ–¼ æ˜¨æ—¥æ”¶ç›¤åƒ¹ï¼Œå‰‡ï¼š`OBV = å‰ä¸€å¤© OBV + ç•¶æ—¥æˆäº¤é‡`
  - è‹¥ä»Šæ—¥æ”¶ç›¤åƒ¹ ä½æ–¼ æ˜¨æ—¥æ”¶ç›¤åƒ¹ï¼Œå‰‡ï¼š`OBV = å‰ä¸€å¤© OBV - ç•¶æ—¥æˆäº¤é‡`
  - è‹¥ä»Šæ—¥æ”¶ç›¤åƒ¹ ç­‰æ–¼ æ˜¨æ—¥æ”¶ç›¤åƒ¹ï¼Œå‰‡ï¼š`OBV = å‰ä¸€å¤© OBV`

### ğŸ”¹ Python ä»£ç¢¼
```python
# å‡è¨­ DataFrame ä¸­æœ‰ "Volume" æ¬„ä½
volume = df["Volume"].values.astype(np.float64)

# è¨ˆç®— OBV
df["OBV"] = talib.OBV(close, volume)

# å„²å­˜çµæœ
output_file = "data/è‚¡å¸‚è³‡æ–™_OBV.xlsx"
df.to_excel(output_file, index=False)
print(f"âœ… OBV è¨ˆç®—çµæœå·²å„²å­˜åˆ° {output_file}")
```

## ğŸ“Œ ç¸½çµ
| æŒ‡æ¨™åç¨± | ç”¨é€” | é©ç”¨æƒ…å¢ƒ |
|-|-|--|
| MACD | åˆ¤æ–·å¸‚å ´è¶¨å‹¢ | é•·çŸ­æœŸå‡ç·šäº¤å‰ã€è¶¨å‹¢è®ŠåŒ– |
| ATR | æ¸¬é‡å¸‚å ´æ³¢å‹• | è¶¨å‹¢äº¤æ˜“èˆ‡é¢¨éšªç®¡ç† |
| CCI | è¶…è²·/è¶…è³£åˆ¤æ–· | é †å‹¢èˆ‡åè½‰äº¤æ˜“ç­–ç•¥ |
| Williams %R | è¶…è²·/è¶…è³£åˆ¤æ–· | æ¢ç´¢çŸ­æœŸå›èª¿èˆ‡é€²å ´é» |
| OBV | è³‡é‡‘æµå‘æŒ‡æ¨™ | ç¢ºèªè¶¨å‹¢æ–¹å‘ï¼Œæ­é…åƒ¹æ ¼åˆ†æ |

é€™äº›æŠ€è¡“æŒ‡æ¨™çµåˆ Python å¯ä»¥æ›´å…¨é¢åœ°åˆ†æå¸‚å ´å‹•æ…‹ï¼Œä¸¦æ‡‰ç”¨æ–¼é‡åŒ–äº¤æ˜“ç­–ç•¥ ğŸš€