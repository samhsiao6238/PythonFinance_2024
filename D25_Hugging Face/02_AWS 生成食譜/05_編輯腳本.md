# ç·¨è¼¯è…³æœ¬

1. å®‰è£å¥—ä»¶ã€‚

```bash
pip install boto3 transformers langchain-aws awscli
```

2. ç¨‹å¼ç¢¼ã€‚

   ```python
   # æ“ä½œç³»çµ±ç›¸é—œçš„åŠŸèƒ½
   import os
   # è®€å–ç’°å¢ƒè®Šæ•¸
   from dotenv import load_dotenv  
   # ç”¨æ–¼ç”Ÿæˆæç¤ºæ¨¡æ¿å’Œè™•ç†å¤§èªè¨€æ¨¡å‹éˆ
   from langchain import PromptTemplate, LLMChain  
   # ç”¨æ–¼ç”Ÿæˆå„ç¨®è‡ªç„¶èªè¨€è™•ç†ç®¡é“
   from transformers import pipeline
   import streamlit as st
   # ç”¨æ–¼é€£æ¥ Amazon Bedrock
   from langchain.llms.bedrock import Bedrock

   # è¨­å®š Streamlit é é¢çš„é…ç½®
   PAGE_CONFIG = {
       # é é¢æ¨™é¡Œ
       "page_title": "Image to Recipe",
       # é é¢åœ–æ¨™
       "page_icon": ":chef:",
       # é é¢ä½ˆå±€ç‚ºå±…ä¸­
       "layout": "centered",
   }
   # è¨­å®šé é¢é…ç½®
   st.set_page_config(PAGE_CONFIG)
   st.markdown(
       """
       <style>
           body {
               /*è¨­å®šé é¢çš„èƒŒæ™¯é¡è‰²*/
               background-color: #fafafa;
               /*è¨­å®šé é¢çš„å­—é«”é¡è‰²*/
               color: #333;
           }
           h1, h2 {
               /*è¨­å®šæ¨™é¡Œçš„å­—é«”é¡è‰²*/
               color: #ff6347;
           }
           .fileUploader .btn {
               /*è¨­å®šä¸Šå‚³æŒ‰éˆ•çš„èƒŒæ™¯é¡è‰²*/
               background-color: #ff6347;
               /*è¨­å®šä¸Šå‚³æŒ‰éˆ•çš„å­—é«”é¡è‰²*/
               color: white;
           }
       </style>
       """,
       unsafe_allow_html=True,
   )

   # å®šç¾©å‡½æ•¸ä»¥ç²å–å¤§èªè¨€æ¨¡å‹
   def get_llm():
       bedrock_llm = Bedrock(
           # ä½¿ç”¨ Claude v2 æ¨¡å‹
           model_id="anthropic.claude-v2",
           # è¨­å®šæ¨¡å‹åƒæ•¸
           model_kwargs={
               "temperature": 0.7,
               "max_tokens_to_sample": 4096
           },
       )
       # è¿”å›å¤§èªè¨€æ¨¡å‹å¯¦ä¾‹
       return bedrock_llm

   # å®šç¾©å‡½æ•¸å°‡åœ–åƒè½‰æ›ç‚ºæ–‡å­—
   def image_to_text(url):
       # é¡¯ç¤ºè™•ç†ä¸­çš„æç¤º
       with st.spinner("Processing image..."):
           pipe = pipeline(
               "image-to-text",
               model="Salesforce/blip-image-captioning-large",
               max_new_tokens=1000,
           )
           # ç²å–åœ–åƒç”Ÿæˆçš„æ–‡å­—
           text = pipe(url)[0]["generated_text"]
       # è¿”å›ç”Ÿæˆçš„æ–‡å­—
       return text

   # å®šç¾©å‡½æ•¸ç”Ÿæˆé£Ÿè­œ
   def generate_recipe(ingredients):
       template = """
       You are a extremely knowledgeable nutritionist, bodybuilder and chef who also knows
                   everything one needs to know about the best quick, healthy recipes. 
                   You know all there is to know about healthy foods, healthy recipes that keep 
                   people lean and help them build muscles, and lose stubborn fat.

                   You've also trained many top performers athletes in body building, and in extremely 
                   amazing physique. 

                   You understand how to help people who don't have much time and or 
                   ingredients to make meals fast depending on what they can find in the kitchen. 
                   Your job is to assist users with questions related to finding the best recipes and 
                   cooking instructions depending on the following variables:
                   0/ {ingredients}

                   When finding the best recipes and instructions to cook,
                   you'll answer with confidence and to the point.
                   Keep in mind the time constraint of 5-10 minutes when coming up
                   with recipes and instructions as well as the recipe.

                   If the {ingredients} are less than 3, feel free to add a few more
                   as long as they will compliment the healthy meal.


                   Make sure to format your answer as follows:
                   - The name of the meal as bold title (new line)
                   - Best for recipe category (bold)

                   - Preparation Time (header)

                   - Difficulty (bold):
                       Easy
                   - Ingredients (bold)
                       List all ingredients 
                   - Kitchen tools needed (bold)
                       List kitchen tools needed
                   - Instructions (bold)
                       List all instructions to put the meal together
                   - Macros (bold): 
                       Total calories
                       List each ingredient calories
                       List all macros 

                       Please make sure to be brief and to the point.  
                       Make the instructions easy to follow and step-by-step.
       """

       # é¡¯ç¤ºç”Ÿæˆé£Ÿè­œä¸­çš„æç¤º
       with st.spinner("Making the recipe for you..."):
           # å‰µå»ºæç¤ºæ¨¡æ¿
           prompt = PromptTemplate(template=template, input_variables=["ingredients"])
           # ç²å–å¤§èªè¨€æ¨¡å‹
           llm = get_llm()
           # å‰µå»ºèªè¨€æ¨¡å‹éˆ
           recipe_chain = LLMChain(
               llm=llm,
               prompt=prompt,
               verbose=True
           )
           # ç”Ÿæˆé£Ÿè­œ
           recipe = recipe_chain.run(ingredients)
       # è¿”å›ç”Ÿæˆçš„é£Ÿè­œ
       return recipe

   # å®šç¾©ä¸»å‡½æ•¸
   def main():
       # é¡¯ç¤ºé é¢æ¨™é¡Œ
       st.markdown(
           "<h1 style='text-align: center; color: red;'>ğŸ² Recipe Generator ğŸ² </h1>",
           unsafe_allow_html=True,
       )
       # é¡¯ç¤ºå­æ¨™é¡Œ
       st.markdown(
           "<h2 style='text-align: center; font-size: 24px; color: black'>Powered by <span style='color: orange;'>Amazon Bedrock</span></h2>",
           unsafe_allow_html=True,
       )

       st.markdown(
           """
           <div style="display: flex; justify-content: center;">
               <a href="https://d1nd1o4zkls5mq.cloudfront.net/img1.jpeg" target="_blank">
                   <button style="margin-right: 10px; color: white; background-color: #007BFF; border: none; border-radius: 2px; padding: 10px 15px; transition: background-color 0.3s;">
                       Download Sample Image 1
                   </button>
               </a>
               <a href="https://d1nd1o4zkls5mq.cloudfront.net/img2.jpeg" target="_blank">
                   <button style="color: white; background-color: #007BFF; border: none; border-radius: 2px; padding: 10px 15px; transition: background-color 0.3s;">
                       Download Sample Image 2
                   </button>
               </a>
           </div>
           <style>
               button:hover {
                   background-color: #0056b3;
               }
           </style>
       """,
           unsafe_allow_html=True,
       )

       upload_file = st.file_uploader(
           "Choose an image:", type=["jpg", "png"], 
           # æä¾›åœ–ç‰‡ä¸Šå‚³åŠŸèƒ½
           accept_multiple_files=False
       )
       # å¦‚æœæœ‰æ–‡ä»¶ä¸Šå‚³
       if upload_file is not None:
           # ç²å–æ–‡ä»¶çš„ä½å…ƒçµ„æ•¸æ“š
           file_bytes = upload_file.getvalue()
           with open(upload_file.name, "wb") as file:
               # å°‡æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°
               file.write(file_bytes)

           st.image(
               upload_file,caption="The uploaded image", 
               # é¡¯ç¤ºä¸Šå‚³çš„åœ–ç‰‡
               use_column_width=True,
               width=250
           )
           # é¡¯ç¤ºå¾åœ–ç‰‡ä¸­æå–çš„æˆåˆ†
           st.markdown("### ğŸ¥— Ingredients from Image") 
           # å°‡åœ–ç‰‡è½‰æ›ç‚ºæ–‡å­—ï¼ˆæˆåˆ†ï¼‰
           ingredients = image_to_text(upload_file.name)
           with st.expander("Ingredients ğŸ‘€"):
               # é¡¯ç¤ºæå–çš„æˆåˆ†
               st.write(ingredients.capitalize())
           # é¡¯ç¤ºç”Ÿæˆçš„é£Ÿè­œ
           st.markdown("### ğŸ“‹ Recipe")
           # æ ¹æ“šæˆåˆ†ç”Ÿæˆé£Ÿè­œ
           recipe = generate_recipe(ingredients=ingredients)
           with st.expander("Cooking Instructions ğŸ‘€"):
               # é¡¯ç¤ºé£Ÿè­œ
               st.write(recipe)
           # é¡¯ç¤ºæ›´å¤šè³‡è¨Šçš„é€£çµ
           st.markdown(
               "<h3 style='text-align: center; font-size: 30px;'> To know more about Amazon Bedrock, visit <a href='https://aws.amazon.com/bedrock/' target='_blank'>here</a> </h3>",
               unsafe_allow_html=True,
           )
           # åˆªé™¤æœ¬åœ°ä¿å­˜çš„æ–‡ä»¶
           os.remove(upload_file.name)

   if __name__ == "__main__":
       # è¼‰å…¥ .env æ–‡ä»¶ä¸­çš„ç’°å¢ƒè®Šæ•¸
       load_dotenv()
       # ç²å– OpenAI API é‡‘é‘°
       OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
       # ç²å– Hugging Face Hub API ä»¤ç‰Œ
       HUGGINFACE_HUB_API_TOKEN = os.getenv("HUGGINFACE_HUB_API_TOKEN")
       # åŸ·è¡Œä¸»å‡½æ•¸
       main()
   ```

## èªªæ˜äº‹é …

_é‡å°åŸè…³æœ¬çš„ä¿®æ­£_


1. PromptTemplate æ‡‰å¾ langchain_core.prompts å¼•å…¥ã€‚

2. LLMChain æ‡‰å¾ langchain.chains å¼•å…¥ã€‚

3. Bedrock æ‡‰å¾ langchain_community.llms å¼•å…¥ã€‚

4. st.set_page_config éœ€è¦ä½¿ç”¨é—œéµå­—åƒæ•¸ï¼Œè€Œä¸æ˜¯å°‡å­—å…¸ç›´æ¥å‚³éçµ¦å®ƒã€‚

5. æ›´æ–° Bedrock å°å…¥ï¼Œæ‡‰è©²å¾ langchain_aws æ¨¡çµ„è€Œä¸æ˜¯ langchain_community æ¨¡çµ„å°å…¥ BedrockLLMã€‚ 

## é‹è¡Œå¾Œ

1. æœƒä¸‹è¼‰æ¨¡å‹ã€‚

    ![](images/img_09.png)