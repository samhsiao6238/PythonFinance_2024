# ä¸‹è¼‰å­—å¹•

_YT è¦ç¯„æ”¹è®Šå¾Œï¼Œå½±ç‰‡ä¸‹è¼‰å¯èƒ½æœƒæœ‰å•é¡Œï¼Œä½†æ˜¯å­—å¹•ä¸‹è¼‰æ˜¯æ²’å•é¡Œçš„_

<br>

## ä»£ç¢¼

1. å¾ YouTube å½±ç‰‡ URL æå–å½±ç‰‡ IDï¼Œæ”¯æ´ `https://www.youtube.com/watch?v=VIDEO_ID`ã€`https://youtu.be/VIDEO_ID`ã€‚

    ```python
    import re
    import os
    from youtube_transcript_api import YouTubeTranscriptApi, TranscriptsDisabled, NoTranscriptFound

    # ç¶²å€
    video_url = "https://www.youtube.com/watch?v=0RrV2nmsPl0"


    # æå–å½±ç‰‡ ID
    def extract_video_id(url):
        match = re.search(r"(?:v=)([^&#]+)", url)
        if match:
            return match.group(1)
        match = re.search(r"(?:youtu\.be/)([^&#]+)", url)
        if match:
            return match.group(1)
        return None


    # å–å¾—å½±ç‰‡å¯ç”¨çš„å­—å¹•èªè¨€
    def get_available_transcripts(video_id):
        try:
            transcript_list = YouTubeTranscriptApi.list_transcripts(video_id)
            available_languages = {t.language_code: t.language for t in transcript_list}
            return available_languages
        except Exception as e:
            print(f"âŒ ç„¡æ³•å–å¾—å­—å¹•åˆ—è¡¨: {e}")
            return {}


    # ä¸‹è¼‰ YouTube å½±ç‰‡å­—å¹•ä¸¦å„²å­˜ç‚ºæ–‡å­—æª”æ¡ˆï¼Œä¸¦å¯é¸æ“‡é¡¯ç¤ºå­—å¹•å…§å®¹
    def download_transcript(
            url,
            lang_code="zh-TW",
            output_file="transcript.txt",
            # æ˜¯å¦åœ¨ Jupyter Notebook å…§é¡¯ç¤ºå­—å¹•
            display=True
    ):
        video_id = extract_video_id(url)
        if not video_id:
            print("âŒ ç„¡æ³•è§£æå½±ç‰‡ IDï¼Œè«‹ç¢ºèªç¶²å€æ˜¯å¦æ­£ç¢º")
            return None

        # å–å¾—å¯ç”¨å­—å¹•èªè¨€
        available_languages = get_available_transcripts(video_id)
        if not available_languages:
            print("âŒ æ­¤å½±ç‰‡æ²’æœ‰å¯ç”¨å­—å¹•")
            return None

        print(f"ğŸ“Œ å¯ç”¨å­—å¹•èªè¨€: {available_languages}")

        if lang_code not in available_languages:
            print(f"âŒ æ‰¾ä¸åˆ° '{lang_code}' é€™ç¨®èªè¨€çš„å­—å¹•ã€‚è«‹ä½¿ç”¨å¯ç”¨èªè¨€ä¹‹ä¸€: {list(available_languages.keys())}")
            return None

        try:
            transcript = YouTubeTranscriptApi.get_transcript(video_id, languages=[lang_code])
        except NoTranscriptFound:
            print(f"âŒ æŒ‡å®šèªè¨€ '{lang_code}' æ²’æœ‰å­—å¹•")
            return None
        except TranscriptsDisabled:
            print("âŒ æ­¤å½±ç‰‡çš„å­—å¹•å·²è¢«ç¦ç”¨ï¼Œç„¡æ³•ä¸‹è¼‰")
            return None
        except Exception as e:
            print(f"âŒ ç™¼ç”ŸéŒ¯èª¤: {e}")
            return None

        # å„²å­˜å­—å¹•
        with open(output_file, "w", encoding="utf-8") as f:
            for entry in transcript:
                f.write(f"{entry['start']:.2f} - {entry['start'] + entry['duration']:.2f}: {entry['text']}\n")

        print(f"âœ… '{lang_code}' å­—å¹•å·²ä¸‹è¼‰ä¸¦å„²å­˜è‡³ {output_file}")

        if display:
            print("\nğŸ“Œ å½±ç‰‡å­—å¹•å…§å®¹:")
            for entry in transcript:
                print(f"{entry['start']:.2f} - {entry['start'] + entry['duration']:.2f}: {entry['text']}")
        # è¿”å›å­—å¹•å…§å®¹
        return transcript

    # æŒ‡å®šä¸­æ–‡å­—å¹•
    download_transcript(video_url, lang_code="zh-TW")
    ```

<br>

2. æ­£å‰‡è¡¨é”è™•ç†ã€‚

    ```python
    import re

    # è®€å–å­—å¹•æª”æ¡ˆå…§å®¹
    file_path = "transcript.txt"
    with open(file_path, "r", encoding="utf-8") as file:
        transcript_lines = file.readlines()

    # æ­£å‰‡è¡¨é”å¼ï¼šç§»é™¤æ™‚é–“æ¨™è¨˜èˆ‡å†’è™Ÿå¾Œçš„ç©ºæ ¼
    cleaned_transcript = [re.sub(r"^\d+\.\d+ - \d+\.\d+: ", "", line).strip() for line in transcript_lines]

    # ç¢ºä¿æ¯å¥è©±ä»¥å¥è™Ÿçµå°¾
    final_transcript = [line if line.endswith("ã€‚") else line + "ã€‚" for line in cleaned_transcript]

    # è½‰æ›ç‚ºç´”æ–‡å­—æ ¼å¼
    cleaned_text = "\n".join(final_transcript)

    # å„²å­˜æ¸…ç†å¾Œçš„å­—å¹•
    cleaned_file_path = "transcript_æ­£å‰‡è¡¨é”.txt"
    with open(cleaned_file_path, "w", encoding="utf-8") as file:
        file.write(cleaned_text)

    # è¿”å›æ¸…ç†å¾Œçš„æª”æ¡ˆè·¯å¾‘
    cleaned_file_path
    ```

<br>

___

_END_