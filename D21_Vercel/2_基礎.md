# åœ¨ Vercel éƒ¨ç½² LineBot

_å¯¦ä½œï¼šé€™éƒ¨åˆ†ä¸»è¦æ˜¯åœ¨ä»‹ç´¹ Vercel èˆ‡ GitHub æ•´åˆï¼Œä¸¦ä»¥å»ºç«‹ Line Bot ç‚ºä¾‹ã€‚_

</br>

## MacOS

1. å»ºç«‹ä¸¦é€²å…¥å°ˆæ¡ˆç›®éŒ„ï¼Œé€™è£¡ä½¿ç”¨ `01_åŸºç¤`ï¼‰ã€‚

    ```bash
    mkdir <å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±> && cd <å°ˆæ¡ˆè³‡æ–™å¤¾åç¨±>
    ```

</br>

2. åœ¨å°ˆæ¡ˆè³‡æ–™å¤¾å…§é–‹å•Ÿæ–°çš„å·¥ä½œå€ã€‚

    ```bash
    code .
    ```

</br>

3. è‹¥è¦éƒ¨ç½²åœ¨ `Vercel`ï¼Œè¦å»ºç«‹å¦‚ä¸‹çš„è³‡æ–™çµæ§‹ã€‚

    ![](images/img_51.png)

    _æŒ‡ä»¤_

    ```bash
    mkdir api && touch api/index.py
    touch requirements.txt
    touch vercel.json
    ```

</br>

4. åœ¨ VSCode ä¸­ç·¨è¼¯ `index.py`ã€‚

    ```python
    # å°å…¥ Flask ç›¸é—œæ¨¡çµ„
    from flask import Flask, request, abort

    # å°å…¥ LineBot ç›¸é—œæ¨¡çµ„
    from linebot import LineBotApi, WebhookHandler

    # å°å…¥ LineBot çš„ä¾‹å¤–è™•ç†
    from linebot.exceptions import InvalidSignatureError

    # å°å…¥ LineBot çš„æ¨¡å‹
    from linebot.models import MessageEvent, TextMessage, TextSendMessage

    import os  # å°å…¥ os æ¨¡çµ„

    # å¾ç’°å¢ƒè®Šæ•¸ä¸­ç²å– LineBot çš„è¨­ç½®
    line_bot_api = LineBotApi(os.getenv("LINE_CHANNEL_ACCESS_TOKEN"))
    line_handler = WebhookHandler(os.getenv("LINE_CHANNEL_SECRET"))
    # å‰µå»º Flask æ‡‰ç”¨
    app = Flask(__name__)


    # å®šç¾©æ ¹è·¯ç”±
    @app.route("/")
    def home():
        # è¿”å›ç°¡å–®çš„æ–‡å­—è¨Šæ¯
        return "=== é€™æ˜¯é è¨­çš„é¦–é  ==="


    # å®šç¾© webhook è·¯ç”±
    @app.route("/webhook", methods=["POST"])
    def callback():
        # ç²å– X-Line-Signature æ¨™é ­å€¼
        signature = request.headers["X-Line-Signature"]
        # ç²å–è«‹æ±‚ä¸»é«”
        body = request.get_data(as_text=True)
        # è¨˜éŒ„è«‹æ±‚ä¸»é«”
        app.logger.info("Request body: " + body)
        try:
            # è™•ç† webhook ä¸»é«”
            line_handler.handle(body, signature)
        # æ•æ‰ç„¡æ•ˆç°½åçš„éŒ¯èª¤
        except InvalidSignatureError:
            # è¿”å› 400 éŒ¯èª¤
            abort(400)
        # è¿”å›æ­£ç¢ºçš„éŸ¿æ‡‰
        return "OK"


    # è™•ç† Line çš„è¨Šæ¯äº‹ä»¶
    @line_handler.add(MessageEvent, message=TextMessage)
    def handle_message(event):

        if event.message.type != "text":
            line_bot_api.reply_message(
                event.reply_token, TextSendMessage(text="æˆ‘ç›®å‰åƒ…å¯ä»¥è®€å–æ–‡å­—è¨Šæ¯")
            )
            return
        if event.message.text == "èªªè©±":

            line_bot_api.reply_message(
                event.reply_token, TextSendMessage(text="æˆ‘å¯ä»¥èªªè©±å›‰ï¼Œæ­¡è¿ä¾†è·Ÿæˆ‘äº’å‹• ^_^ ")
            )
            return
        else:
            line_bot_api.reply_message(
                event.reply_token, TextSendMessage(text="æˆ‘ç›®å‰é‚„æœªæ“æœ‰å°æ‡‰çš„åŠŸèƒ½")
            )
            return


    if __name__ == "__main__":
        # é‹è¡Œ Flask æ‡‰ç”¨
        app.run()

    ```

</br>

5. ç·¨è¼¯å¥—ä»¶ç®¡ç†æª”æ¡ˆ `requirements.txt` ï¼Œå¥—ä»¶æœ‰ç‰ˆæœ¬ç›¸å®¹å•é¡Œï¼Œæ‰€ä»¥è¦åŠ ä¸Šç‰ˆæœ¬è™Ÿã€‚

    ```txt
    Flask==2.2.2
    line-bot-sdk
    Werkzeug==2.3.7
    ```

</br>

6. å»ºç«‹ Vercel è¨­å®šæª”æ¡ˆ `vercel.json`ã€‚

    ```json
    {
        "builds": [
        {
            "src": "api/index.py",
            "use": "@vercel/python"
        }
        ],
        "routes": [
        {
            "src": "/(.*)",
            "dest": "api/index.py"
        }
        ]
    }
    ```

</br>

7. å®Œæˆå¾Œå¯é€é Vercel CLI é€²è¡Œéƒ¨ç½²ã€‚

    ```bash
    sudo vercel
    ```

</br>

8. åœ¨è¨­å®šçš„æ­¥é©Ÿã€‚
	1. åŒæ„è¨­å®šä¸”éƒ¨ç½²ç›®å‰æ‰€åœ¨çš„è³‡æ–™å¤¾ï¼ˆYï¼‰
	2. é¸æ“‡å°ˆæ¡ˆçš„æ“æœ‰è€…ï¼Œå”¯ä¸€é¸æ“‡ï¼Œæ‰€ä»¥ç­‰æ–¼æ²’é¸ï¼ˆENTERï¼‰
	3. æ˜¯å¦é€£çµç¾æœ‰å°ˆæ¡ˆï¼ˆNï¼‰
	4. å°ˆæ¡ˆåç¨±ï¼Œä½¿ç”¨é è¨­å³å¯ï¼ˆENTERï¼‰
	5. åœ¨å“ªå€‹ç›®éŒ„ï¼ˆENTERï¼‰

    ![](images/img_52.png)

</br>

9. é–‹å§‹éƒ¨ç½²ã€‚

    ![](images/img_53.png)

</br>

10. å®Œæˆæ™‚æœƒé¡¯ç¤ºé€£çµï¼Œå¯ä»¥ä¸ç”¨æ€¥è‘—è¤‡è£½ï¼Œç­‰ä¸€ä¸‹åœ¨å°ˆæ¡ˆæ§åˆ¶å°å»è¤‡è£½ã€‚

    ![](images/img_54.png)

</br>

## B. å‰å¾€ Line Developers

1. é–‹å•Ÿ [Line Developers](https://developers.line.biz/zh-hant/)ã€‚

    ![](images/img_55.png)

</br>

_çœç•¥ä¸€éƒ¨åˆ†çš„èªªæ˜ï¼Œé€™è£¡çš„æ“ä½œå¾ˆç°¡å–®ï¼Œæœ‰å¿…è¦å†è£œå……_

</br>

2. å»ºç«‹æ–°çš„ channelã€‚

    ![](images/img_56.png)

</br>

3. é¸æ“‡ Messaging APIã€‚

    ![](images/img_57.png)

</br>

4. é€™éƒ¨åˆ†é¸å–åœ°å€ï¼Œå…¶ä»–é è¨­ã€‚

    ![](images/img_58.png)    

</br>

5. çµ¦å€‹åœ–ç‰‡æ¼‚äº®ä¸€é»ã€‚

    ![](images/img_59.png)

</br>

6. éš¨æ„è¨­å®šä¸€ä¸‹ã€‚

    ![](images/img_60.png)

</br>

7. æ»‘å‹•åˆ°æœ€ä¸‹é¢ï¼Œå‹¾é¸ä¹‹å¾Œå»ºç«‹ã€‚

    ![](images/img_61.png)

</br>

8. OKã€‚

    ![](images/img_62.png)

</br>

9. Agreeã€‚

    ![](images/img_63.png)

</br>

10. åœ¨é€™å€‹é é¢å…ˆè¤‡è£½ `Channel secret` æº–å‚™èµ·ä¾†ã€‚

    ![](images/img_64.png)

</br>

11. åˆ‡æ›åˆ°ã€‚

    ![](images/img_65.png)

</br>

12. Issueã€‚

    ![](images/img_66.png)

</br>

13. è¤‡è£½ã€‚

    ![](images/img_67.png)

</br>

14. æ¥ä¸‹ä¾†å¾ˆé‡è¦ä¸€ä»¶äº‹æ˜¯è¨­å®š `Webhook`ã€‚

    ![](images/img_68.png)

</br>

## C. å‰å¾€ Vercel ä¸»æ§å°

1. åˆ° Vercel ä¸»æ§å°ï¼Œé»æ“Šå‰›å‰›ä¸Šå‚³çš„å°ˆæ¡ˆï¼Œé€™è£¡ç¤ºç¯„æ˜¯ `test06`ã€‚

   ![](images/img_69.png)

</br>

2. å…ˆè¤‡è£½ Domainã€‚
   - é€™å€‹æ™‚å€™ç¶²é æ˜¯éŒ¯èª¤çš„ï¼Œä¸ç”¨ç†æœƒ

    ![](images/img_70.png)   

</br>

## D. å‰å¾€ Line Developers

1. å›åˆ° Line Developersï¼Œç·¨è¼¯ Webhookã€‚

   ![](images/img_71.png)

</br>

2. è²¼ä¸Šç¶²å€ï¼ŒåŠ ä¸Šã€Œ/webhookã€ï¼Œç„¶å¾Œ Updateã€‚

    ![](images/img_72.png)

</br>

3. ç‰¹åˆ¥èªªæ˜é€™è£¡çš„ `webhook` å°¾ç¶´æ˜¯å®šç¾©åœ¨ `index.py` ä¸­çš„è·¯ç”±ã€‚

   ![](images/img_73.png)

</br>

4. é–‹å•Ÿ `Use webhook`ã€‚

   ![](images/img_74.png)

</br>

5. é€™æ™‚é‚„æ²’å®Œæˆè¨­å®šï¼Œé»æ“Šé©—è­‰æœƒæ˜¯éŒ¯çš„ã€‚

    ![](images/img_76.png)

</br>

6. ç¹¼çºŒé€²è¡Œè¨­å®šï¼Œé»æ“Š Editã€‚

    ![](images/img_78.png)

</br>

7. é¸æ“‡æ¥å—é‚€è«‹ã€‚

    ![](images/img_79.png)

</br>

8. ç¸½çš„ä¾†èªªæ˜¯é€™æ¨£ã€‚

    ![](images/img_80.png)

</br>

_ğŸ”º ä»¥ä¸Šå®Œæˆç¬¬ä¸€éšæ®µçš„ Line Developers è¨­å®š_

</br>

## E. é€²å…¥ Vercel

1. æ¥è‘—é€²å…¥ Vercel çš„è¨­å®šã€‚

   ![](images/img_81.png)

</br>

2. é»æ“Šå·¦å´ç’°å¢ƒè®Šæ•¸ã€‚
   
   ![](images/img_82.png)

</br>

3. è¤‡è£½ç¨‹å¼ç¢¼ä¸­çš„å…©å€‹ç’°å¢ƒè®Šæ•¸åç¨±ä½œç‚º Keyã€‚
   
   ![](images/img_83.png)

</br>

4. å…ˆè²¼ä¸Š Keyï¼Œå†è²¼ä¸Š Line Develop æ‰€æä¾›å°æ‡‰çš„ `Token` èˆ‡ `Secret` çš„å€¼ã€‚
   
   ![](images/img_84.png)

</br>

5. å‹™å¿…è¨˜å¾—å„²å­˜ã€‚
   
   ![](images/img_85.png)

</br>

## F. é€²å…¥ VSCode

1. å°‡å°ˆæ¡ˆç™¼ä½ˆåˆ°æ–°çš„å„²å­˜åº«ä¸­ã€‚

   ![](images/img_86.png)

</br>

2. é¸å…¬é–‹ã€‚

   ![](images/img_87.png)

</br>

## G. å†å›åˆ° Vercel ä¸­

1. é»æ“Šé€£çµåˆ°å°ˆæ¡ˆã€‚

   ![](images/img_88.png)

</br>

2. é¸å– GitHubã€‚

   ![](images/img_89.png)

</br>

3. é€£çµã€‚
   
   ![](images/img_90.png)

</br>

4. é€™è£¡å¯ä»¥æŸ¥çœ‹ `Source code` ç¢ºèªæ˜¯å¦ç‚ºæ›´æ–°çš„å…§å®¹ã€‚

   ![](images/img_91.png)

</br>

## H. é©—è­‰çµæœ

1. Vercel çš„éƒ¨ç½²æœ‰æ™‚æœƒæœ‰å»¶é²ç‹€æ³ï¼Œå¯ä»¥é€éå»ä¿®æ”¹ä¸€ä¸‹ `index.py` ä¾†åŒæ­¥ä¸¦è§€å¯Ÿä¸€ä¸‹éƒ¨ç½²ç‹€æ³ã€‚

   ![](images/img_92.png)

</br>

2. ç›´åˆ°ç•«é¢æ­£å¸¸é¡¯ç¤ºå°±è¡¨ç¤ºéƒ¨ç½²å®Œæˆã€‚

   ![](images/img_93.png)

</br>

3. ä¹Ÿå¯ä»¥é€éé©—è­‰ Webhook ç¢ºèªæ˜¯å¦å®Œæˆéƒ¨ç½²ã€‚

   ![](images/img_94.png)

</br>

## I. å…¶ä»–è£œå……

    _ä»‹ç´¹å®Œä¼ºæœå™¨å¾Œï¼Œå†ä½¿ç”¨ `Ngrok` å°‡ LineBot éƒ¨ç½²åœ¨æ¨¹è“æ´¾ä¸Š_

</br>

---

_END:é€™è£¡åƒ…æ˜¯ç¢ºèªéƒ¨ç½²ï¼Œè‡³æ–¼è…³æœ¬å…§å®¹ä¸¦ç„¡å¤ªå¤šåŠŸèƒ½_