# 測試 PostgreSQL 設置

_這個測試是基於前面小節中的設置已經完成然後進行的_

<br>

## 準備工作

1. 安裝 `psycopg2` 庫來操作 PostgreSQL 資料庫。

    ```bash
    pip install psycopg2-binary
    ```

<br>

2. 使用 `dotenv` 管理敏感資訊。

    ```bash
    pip install python-dotenv
    ```

<br>

## 管理敏感資訊

1. 建立文件。

```bash
touch .env .gitignore
```

2. 編輯 `.gitignore`。

```bash
.env
```

3. 編輯 `.env`。

```bash
PGVECTOR_DRIVER=psycopg2
PGVECTOR_USER=
PGVECTOR_PASSWORD=
PGVECTOR_HOST=localhost
PGVECTOR_PORT=5432
PGVECTOR_DATABASE=mydatabase
```


1. 完整程式碼。

    ```python
    import psycopg2
    from psycopg2 import sql
    import os
    from dotenv import load_dotenv()
    load_dotenv()

    # 環境變量設置
    PGVECTOR_DRIVER = os.getenv('PGVECTOR_DRIVER')
    PGVECTOR_USER = os.getenv('PGVECTOR_USER')
    PGVECTOR_PASSWORD = os.getenv('PGVECTOR_PASSWORD')
    PGVECTOR_HOST = os.getenv('PGVECTOR_HOST')
    PGVECTOR_PORT = os.getenv('PGVECTOR_PORT')
    PGVECTOR_DATABASE = os.getenv('PGVECTOR_DATABASE')

    # 連接到 PostgreSQL 數據庫
    conn = psycopg2.connect(
        dbname=PGVECTOR_DATABASE,
        user=PGVECTOR_USER,
        password=PGVECTOR_PASSWORD,
        host=PGVECTOR_HOST,
        port=PGVECTOR_PORT
    )

    # 創建一個新表並插入數據
    try:
        with conn.cursor() as cursor:
            # 創建測試表
            cursor.execute("""
            CREATE TABLE IF NOT EXISTS test_table (
                id SERIAL PRIMARY KEY,
                name VARCHAR(100) NOT NULL
            )
            """)
            print("Table created successfully.")

            # 插入測試數據
            cursor.execute("""
            INSERT INTO test_table (name) VALUES 
            ('Test Name 1'),
            ('Test Name 2')
            """)
            print("Data inserted successfully.")

            # 查詢數據
            cursor.execute("SELECT * FROM test_table")
            rows = cursor.fetchall()
            for row in rows:
                print(row)

        # 提交事務
        conn.commit()
    finally:
        # 關閉連接
        conn.close()
    ```

<br>

2. 輸出。

    ```bash
    Table created successfully.
    Data inserted successfully.
    (1, 'Test Name 1')
    (2, 'Test Name 2')
    ```

<br>

___

_END_