# 快速上手

_根據官方的說明建立簡單的問答系統_

<br>

## 建立虛擬環境

1. 要建立新的虛擬環境來進行操作，細節省略。

    ```bash
    python -m venv envHaystack
    ```

<br>

2. 修改環境參數並啟動虛擬環境。

    ```bash
    source ~/.zshrc
    ```

<br>

3. 建立完成時可查看當前套件環境，並依指示進行更新，確認這是一個乾淨的新環境，便可展開後續操作。

    ![](images/img_10.png)

<br>

## 開始撰寫範例

1. 安裝官方套件 `Haystack` 和 `Chroma`。

    ```bash
    pip install haystack-ai chroma-haystack
    ```

<br>

2. 安裝套件用以設置 OpenAI 的 API Key。

    ```bash
    pip install python-dotenv
    ```

<br>

## 建立敏感文件管理

1. 建立 `.env` 文件。

<br>

2. 寫入 `OPENAI_API_KEY`。

    ```json
    OPENAI_API_KEY=<填入自己的 API KEY>
    ```

<br>

## 繼續編輯腳本

1. 透過腳本從網絡下載文件，並使用 `Haystack` 預設定義索引管道來索引文件；特別注意，腳本中隱式使用了 `OpenAI API`，所以一定要載入環境變數。

    ```python
    import urllib.request
    from haystack import Pipeline, PredefinedPipeline
    import os
    from dotenv import load_dotenv

    load_dotenv()
    # 載入環境變數
    os.environ["OPENAI_API_KEY"] = os.getenv("OPENAI_API_KEY")

    # 下載範例電子書文件
    urllib.request.urlretrieve(
        "https://www.gutenberg.org/cache/epub/7785/pg7785.txt",
        "davinci.txt"
    )

    # 使用預定義的索引管道
    indexing_pipeline = Pipeline.from_template(PredefinedPipeline.INDEXING)
    indexing_pipeline.run(data={"sources": ["davinci.txt"]})
    ```

<br>

2. 建立 RAG 管道：使用預定義的 RAG 管道來回答問題。

    ```python
    from haystack import Pipeline, PredefinedPipeline

    # 建立 RAG 管道
    rag_pipeline = Pipeline.from_template(PredefinedPipeline.RAG)

    # 提出問題
    query = "他是誰？叫什麼名字？出生地在哪裡？他往生的時候是幾歲？"
    # 結果
    result = rag_pipeline.run(
        data={
            "prompt_builder": {"query": query},
            "text_embedder": {"text": query}
        }
    )

    # 輸出答案
    print(result["llm"]["replies"][0])
    ```

<br>

3. 得到以下結果。

    ```bash
    他是利安納多‧達‧文西（Leonardo da Vinci），出生在意大利的小鎮文奇（Vinci），在1519年的復活節前夕去世，享年67歲。"
    ```

<br>

___

_END_