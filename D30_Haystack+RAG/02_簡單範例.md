# 開始

_根據官方的說明建立簡單的問答系統_

<br>

1. 安裝 Haystack 和 Chroma。

```bash
pip install haystack-ai chroma-haystack
```

<br>

2. 安裝套件用以設置 OpenAI 的 API Key。

```bash
pip install python-dotenv
```

<br>

3. 從網絡下載文件，並使用 Haystack 的預定義索引管道來索引文件，特別注意，腳本隱式使用了 OpenAI API，所以一定要載入環境變數。

```python
import urllib.request
from haystack import Pipeline, PredefinedPipeline
import os
from dotenv import load_dotenv

load_dotenv()

os.environ["OPENAI_API_KEY"] = os.getenv("OPENAI_API_KEY")

# 下載範例電子書文件
urllib.request.urlretrieve(
    "https://www.gutenberg.org/cache/epub/7785/pg7785.txt",
    "davinci.txt"
)

# 使用預定義的索引管道
indexing_pipeline = Pipeline.from_template(PredefinedPipeline.INDEXING)
indexing_pipeline.run(data={"sources": ["davinci.txt"]})
```

<br>

4. 建立 RAG 管道：使用預定義的 RAG 管道來回答問題。

```python
from haystack import Pipeline, PredefinedPipeline

# 建立 RAG 管道
rag_pipeline = Pipeline.from_template(PredefinedPipeline.RAG)

# 提出問題
query = "他是誰？叫什麼名字？出生地在哪裡？他往生的時候是幾歲？"
# 結果
result = rag_pipeline.run(
    data={
        "prompt_builder": {"query": query},
        "text_embedder": {"text": query}
    }
)

# 輸出答案
print(result["llm"]["replies"][0])
```

<br>

5. 得到以下結果。

```bash
他是利安納多‧達‧文西（Leonardo da Vinci），出生在意大利的小鎮文奇（Vinci），在1519年的復活節前夕去世，享年67歲。"
```

<br>

___

_END_