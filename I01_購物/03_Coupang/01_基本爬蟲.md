# Coupang

<br>

## 說明

1. 以關鍵字爬取資料，並提供進階篩選的關鍵字從取回的資料中進一步提取資訊；特別說明，這樣的過程會需要兩個步驟，首先確認 `關鍵字` 可取回所需資訊，然後在結果中提取 `進階搜尋關鍵字` 以得到最終結果，假如進階搜尋範圍還是過大，可以添加進階搜尋條件。

    ```python
    from selenium import webdriver
    from selenium.webdriver.chrome.service import Service
    from webdriver_manager.chrome import ChromeDriverManager
    from selenium.webdriver.chrome.options import Options
    from bs4 import BeautifulSoup
    from urllib.parse import quote
    import time

    def get_coupang_search_results(search_keyword: str, advanced_keywords: list[str]):
        encoded_keyword = quote(search_keyword)
        url = f"https://www.tw.coupang.com/search?q={encoded_keyword}&channel=user"

        options = Options()
        # 若需隱藏瀏覽器可啟用
        options.add_argument("--headless=new")
        options.add_argument("--disable-gpu")
        options.add_argument("--no-sandbox")
        options.add_argument("--lang=zh-TW")

        driver = webdriver.Chrome(
            service=Service(
                ChromeDriverManager().install()),
                options=options
        )
        driver.get(url)
        time.sleep(5)

        html = driver.page_source
        # 若需重複操作瀏覽器可先保留不關閉
        driver.quit()

        soup = BeautifulSoup(html, "html.parser")
        product_cards = soup.select(
            "div.SearchResult_searchResultProduct___h6E9"
        )

        results = []
        matched_results = []

        for card in product_cards:
            try:
                # 完整內容文字
                full_text = card.get_text(separator=" ", strip=True)

                # 精簡標題（僅取 title 區塊）
                title_tag = card.select_one("div.Product_title__8K0xk")
                title = title_tag.get_text(strip=True) if title_tag else "N/A"

                # 價格
                price_tag = card.select_one("span.Product_salePricePrice__2FbsL span")
                price = price_tag.get_text(strip=True) if price_tag else "N/A"

                # 每單位價格
                unit_price_tag = card.select_one("div.Product_unitPrice__QQPdR")
                unit_price = unit_price_tag.get_text(strip=True) if unit_price_tag else "N/A"

                product = {
                    "title": title,
                    "full_text": full_text,
                    "price": price,
                    "unit_price": unit_price
                }

                results.append(product)

                # 進階條件：從完整描述中過濾
                if all(kw in full_text for kw in advanced_keywords):
                    matched_results.append(product)

            except Exception as e:
                print("解析錯誤：", e)
                continue

        return results, matched_results

    # 主程式區塊
    if __name__ == "__main__":
        # 搜尋主關鍵字
        search_keyword = "DORO CAT 豆乳貓"

        # 進階篩選條件（需同時包含全部關鍵詞）
        advanced_keywords = ["混合豆腐與礦物貓砂", "6袋"]

        # 執行爬取
        all_products, filtered_products = get_coupang_search_results(
            search_keyword,
            advanced_keywords
        )

        print(f"搜尋關鍵字：{search_keyword}")
        print("所有搜尋結果：")
        for idx, product in enumerate(all_products, 1):
            print(f"{idx}. 標題: {product['title']}")
            print(f"   價格: {product['price']}")
            print(f"   每單位: {product['unit_price']}")
            print(f"   完整內容: {product['full_text']}")
            print("-" * 60)

        print(
            f"\n進階條件符合項目（包含：{'、'.join(advanced_keywords)}）："
        )
        for idx, product in enumerate(filtered_products, 1):
            print(f"{idx}. 標題: {product['title']}")
            print(f"   價格: {product['price']}")
            print(f"   每單位: {product['unit_price']}")
            print(f"   完整內容: {product['full_text']}")
            print("-" * 60)
    ```

<br>

2. 以上的結果在進階搜尋部分會得到。

    ```bash
    進階條件符合項目（包含：混合豆腐與礦物貓砂）：
    1. 標題: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 6袋
    價格: $677
    每單位: ($1.61/100ml)
    完整內容: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 6袋 特價 64折 $1,074 $677 ($1.61/100ml) 7折 優惠券 明天 5/12 (一) 預計送達 免運 ( 65 )
    ------------------------------------------------------------
    2. 標題: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 1袋
    價格: $125
    每單位: ($1.79/100ml)
    完整內容: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 1袋 特價 5折 $250 $125 ($1.79/100ml) 7折 優惠券 明天 5/12 (一) 預計送達 免運 滿 $490 ( 65 )
    ------------------------------------------------------------
    ```

<br>

3. 可依據結果，將進階關鍵字添加一組 `6袋`。

    ```python
    advanced_keywords = ["混合豆腐與礦物貓砂", "6袋"]
    ```

<br>

4. 會進一步篩選得到更細緻的結果。

    ```bash
    進階條件符合項目（包含：混合豆腐與礦物貓砂、6袋）：
    1. 標題: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 6袋
    價格: $677
    每單位: ($1.61/100ml)
    完整內容: DORO CAT 豆乳貓 混合豆腐與礦物貓砂, 無味, 7L, 6袋 特價 64折 $1,074 $677 ($1.61/100ml) 7折 優惠券 明天 5/12 (一) 預計送達 免運 ( 65 )
    ------------------------------------------------------------
    ```

<br>
