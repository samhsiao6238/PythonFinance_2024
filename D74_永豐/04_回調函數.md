# 回調函數

_Callback functions，用於在特定事件發生時自動觸發自定義的邏輯，在 `Shioaji API` 中的回調類型包括登入時設定合約下載的回調，以及下單時設定的委託回報、成交回報等。_

<br>

## `contracts_cb`

1. 在 API 登入階段，可透過 `api.login()` 的參數設定合約下載完成後的回調通知，當指定的合約下載完成時，該回調函數會被觸發，用於監控不同類型的合約下載狀態。

```python
# 定義回調函數
def contracts_callback(security_type):
    print(f"{security_type} 合約下載完成！")

# 登入時設置 contracts_cb 回調
api.login(
    api_key=api_key,
    secret_key=secret_key,
    # 設置合約回調函數
    contracts_cb=contracts_callback
)

# 手動觸發合約下載
api.fetch_contracts(contract_download=True)
```

_輸出_

```bash
Stocks 合約下載完成！
Futures 合約下載完成！
```



## `set_order_callback`

1. 登入成功後，可調用 `set_order_callback` 設置回調，用於接收 `委託回報` 和 `成交回報` 的通知，可透過 `api.set_order_callback()` 來設定，當交易事件發生時回調函數會被觸發，包含如下單成功、成交、取消等。

```python
# 定義回調函數
def order_callback(topic, msg):
    if topic == "Order":
        print(f"【委託回報】\n{msg}")
    elif topic == "Trade":
        print(f"【成交回報】\n{msg}")
    else:
        print(f"【未知回報】類型: {topic}, 訊息: {msg}")

# 設置委託/成交回報回調函數
api.set_order_callback(order_callback)

# 測試：模擬委託下單
contract = api.Contracts.Stocks.TSE["2330"]
order = api.Order(
    price=550,
    quantity=1,
    action=sj.constant.Action.Buy,
    price_type=sj.constant.StockPriceType.LMT,
    order_type=sj.constant.OrderType.ROD,
    account=api.stock_account
)
api.place_order(contract, order)
```

_輸出_

```bash
【委託回報】
{'id': '000112', 'status': 'PendingSubmit', 'price': 550, 'quantity': 1}

【成交回報】
{'trade_price': 550, 'trade_quantity': 1, 'trade_time': '15:30:00'}
```



## `api.on_event`

_事件觸發，Shioaji API 可透過 `api.on_event` 設定全域事件監聽。_

1. 可用於監聽 API 的其他事件如系統狀態、連接中斷等。

```python
# 定義事件回調函數
@api.on_event
def event_callback(topic: str, data: dict):
    print(f"事件回報 - 類型: {topic}, 訊息: {data}")

# 登入並啟用事件監聽
api.login(api_key=api_key, secret_key=api_key)
```

_輸出_

```bash
事件回報 - 類型: Session, 訊息: {'status': 'connected'}
```
