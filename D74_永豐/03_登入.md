# 登入流程

_永豐金 Shioaji API 的登入流程_

## 初始化 API 並登入

1. 程式碼。

```python
import shioaji as sj
import os
from dotenv import load_dotenv

load_dotenv()

api_key = os.environ["API_KEY"]
secret_key = os.environ["SECRET_KEY"]
# 初始化 Shioaji API
# 預設為模擬模式（simulation=True）
api = sj.Shioaji()

# 使用 API 金鑰與密鑰登入
accounts = api.login(
    api_key=api_key,
    secret_key=secret_key
)

# 印出帳號資訊
print(accounts)
```

2. 可自訂設定登入選項。

```python
accounts = api.login(
    api_key=api_key,
    secret_key=secret_key,
    # 是否從伺服器下載商品檔（預設為 True）
    fetch_contract=True,
    # 是否訂閱委託/成交回報（預設為 True）
    subscribe_trade=True,
    # 調整有效執行時間為 60 秒
    receive_window=60000
)
# 印出帳號資訊
print(accounts)
```

## 檢查與設定預設帳號

1. 程式碼。

```python
# 列出所有帳號
accounts = api.list_accounts()
print(accounts)

# 設定期貨預設帳號為第二個帳號
api.set_default_account(accounts[1])

# 顯示目前的預設期貨帳號
print(api.futopt_account)
```

## 下單範例

1. 程式碼。

```python
# 建立下單物件
order = api.Order(
    price=15000,
    quantity=1,
    # 買賣方向（買入）
    action=sj.constant.Action.Buy,
    # 限價單
    price_type=sj.constant.FuturesPriceType.LMT,
    # 委託單有效期（當日有效）
    order_type=sj.constant.OrderType.ROD,
    # 倉別（自動）
    octype=sj.constant.FuturesOCType.Auto,
    # 使用預設期貨帳號
    account=api.futopt_account
)

# 取得期貨商品
# 此處為 2023 年 12 月到期的台指期貨
contract = api.Contracts.Futures.TXF.TXF202312

# 下單
trade = api.place_order(contract, order)
print(trade)
```

## 訂閱交易回報

1. 訂閱指定帳號的交易回報。

```python
api.subscribe_trade(api.futopt_account)
```

2. 取消訂閱指定帳號的交易回報。

```python
api.unsubscribe_trade(api.futopt_account)
```

## 登出

1. 程式碼。

```python
# 結束與伺服器的連接，釋放連線資源
api.logout()
```

