# Credit Enquires

_用於查詢股票在各信用交易系統中的資訊，包含 `可用融資（margin）餘額`、`可用融券（short）餘額`；再次強調，`margin_unit` 是 `可用融資餘額`、`short_unit` 是 `可用融券餘額`。_

<br>

## 函數說明

_`api.credit_enquires()`_

<br>

1. 可查詢股票在信用交易市場中的狀況，如 `可用融資餘額 (margin_unit)`、`可用融券餘額 (short_unit)` 以及 `最後更新時間(update_time)`。

    ```python
    api.credit_enquires(
        # 合約列表
        contracts: List[shioaji.contracts.Stock],
        # 查詢逾時時間（毫秒），預設 `30000` 毫秒
        timeout: int = 30000,
        # 回呼函式，用於非同步資料處理
        cb: Callable[[shioaji.data.CreditEnquire], NoneType] = None
    ) -> List[shioaji.data.CreditEnquire]
    ```

<br>

2. 回傳值是一個列表 `List[CreditEnquire]`，每個 `CreditEnquire` 物件包含 `update_time ` 資料更新時間、`system` 信用交易系統代號（如 HE、HC、HN、HF）、`stock_id` 股票代號、`margin_unit`、`short_unit (int)`。

<br>

3. 不同的 `system` 代表不同的信用交易市場或渠道，每個系統會有不同的資源狀況，投資者可透過比對同一檔股票在不同系統的資源，判斷何處融資融券比較充裕。

<br>

## 範例

1. 定義欲查詢的股票合約清單。

    ```python
    # 台積電(2330)與第一金(2890)
    contracts = [
        api.Contracts.Stocks['2330'],
        api.Contracts.Stocks['2890']
    ]
    ```

<br>

2. 查詢該合約清單的信用交易資訊。 

    ```python
    # 信用交易資訊
    credit_enquires = api.credit_enquires(contracts)
    # 查看取得的信用交易資訊列表
    credit_enquires
    ```

    _輸出_

    ```bash
    [
        CreditEnquire(
            update_time='2024-12-18 14:32:03.769767', 
            system='HF', 
            stock_id='2330'
        ),
        # 略
    ]
    ```

<br>

3. 將資料轉換為 DataFrame。

    ```python
    import pandas as pd

    # 將每個 CreditEnquire 物件轉為字典，組成 DataFrame
    df = pd.DataFrame(c.__dict__ for c in credit_enquires)
    # 將 update_time 欄位從字串轉為 datetime 格式，方便時間序列分析
    df.update_time = pd.to_datetime(df.update_time)
    # 顯示 DataFrame
    df
    ```

    ![](images/img_92.png)

<br>

4. 查看輸出，可見 `台積電(2330)` 在各系統的 `margin_unit` 值不同，代表不同系統下的融資可用量不同；而 `第一金(2890)` 則全為 0，表示在這些信用系統中該股票已無可用融資單位。

<br>

___

_END_