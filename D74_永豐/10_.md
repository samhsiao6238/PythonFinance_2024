# Scanners

_篩選器，`Scanners` 指的是一種用於篩選、排序特定市場標的的工具與方法，可根據特定的條件或屬性，將符合條件的標的進行排名；透過 Scanners 可快速找到在特定日期或條件下表現最突出或變化最大的商品。_

## 函數說明

_`api.scanners()`，提供快速取得特定排行資訊的方法_

1. 可指定 `scanner_type` 來取得市場所需的排名，支援的 Scanner Type 如下。

```bash
# 根據價格變化百分比(漲幅%)排序
ChangePercentRank  

# 根據價格漲跌金額排序
ChangePriceRank  

# 根據當日價格區間(最高-最低)排序
DayRangeRank

# 根據成交量排序
VolumeRank

# 根據成交金額排序
AmountRank
```

2. 參數介紹。

    ```python
    api.scanners(
        # 排行的類，如 ChangePercentRank, ChangePriceRank 等
        scanner_type: shioaji.constant.ScannerType, 
        # 是否升冪，預設為 True
        ascending: bool = True,
        # 指定日期，預設日期為當前交易日
        date: str = None,
        # 取得前幾名，範圍 `0~200`
        count: int = 100,
        # 逾時時間
        timeout: int = 30000,
        # 回調函數
        cb: Callable[[List[shioaji.data.ChangePercentRank]], None] = None,
    ) -> List[shioaji.data.ChangePercentRank]
    ```

3. 特別注意，參數 `ascending` 在一般邏輯下指的是 `升冪`，`ascending=True` 應表示 `由小到大` 排序，但官方文件中卻描述 `Ascending is sorted from largest to smallest by default, and the value of ascending is True`，`ascending` 的預設為 `True`，依官方的定義則是 `由大到小` 方向排序。

![](images/img_93.png)

  回傳值為一個 `List[ChangePercentRank]`，若為其他排序類型，回傳的物件結構相同或相近，但屬性名稱可能會有略微差異。

- 排序說明：  
  預設 `ascending=True` 時，表示由大到小 (官方文件說明為 "largest to smallest")。若要由小到大排序，請設 `ascending=False`。

- 範例程式碼 (含繁體中文註解)：

  ```python
  # 以 ChangePercentRank (漲幅%) 為例
  # 此範例將取得目前漲幅排名前 1 名的標的
  scanners = api.scanners(
      scanner_type=sj.constant.ScannerType.ChangePercentRank,
      count=1
  )

  # 查看結果
  scanners
  # 可能回傳類似如下的清單:
  # [ChangePercentRank(
  #     date='2021-04-09', code='5211', name='蒙恬', ... 
  # )]
  ```

  將結果轉為 DataFrame：  
  ```python
  import pandas as pd

  # 取得前 5 名漲幅最高的標的
  scanners = api.scanners(
      scanner_type=sj.constant.ScannerType.ChangePercentRank, 
      count=5
  )

  # 將回傳的 ChangePercentRank 物件轉為 DataFrame，便於檢視與分析
  df = pd.DataFrame(s.__dict__ for s in scanners)

  # 將 ts (timestamp) 欄位轉成可讀的日期時間格式
  df.ts = pd.to_datetime(df.ts)

  # 查看 DataFrame
  df
  ```



ChangePercentRank 屬性說明：  
(以下屬性在其他 Rank 類型中可能略有不同，但大同小異)

- `date (str)`: 日期
- `code (str)`: 股票代號
- `name (str)`: 股票名稱
- `ts (int)`: 時間戳記，可轉為 datetime
- `open (float)`: 今日開盤價
- `high (float)`: 今日最高價
- `low (float)`: 今日最低價
- `close (float)`: 最新成交價
- `price_range (float)`: 今日價格區間 (高-低)
- `tick_type (int)`: 內外盤別 (1:外盤、2:內盤、0:無法判定)
- `change_price (float)`: 相對昨日的漲跌金額
- `change_type (int)`: 漲跌種類 (上漲、平盤、下跌、漲停、跌停)
- `average_price (float)`: 加權平均價
- `volume (int)`: 最新一筆成交量
- `total_volume (int)`: 今日累計成交量
- `amount (int)`: 最新一筆成交金額
- `total_amount (int)`: 今日累計成交金額
- `yesterday_volume (int)`: 昨日成交量
- `volume_ratio (float)`: volume / yesterday_volume，即量比
- `buy_price (float)`: 買價
- `buy_volume (int)`: 買量
- `sell_price (float)`: 賣價
- `sell_volume (int)`: 賣量
- `bid_orders (int)`: 買單數量 (以委託單計算)
- `bid_volumes (int)`: 買單總量
- `ask_orders (int)`: 賣單數量
- `ask_volumes (int)`: 賣單總量



總結：  
Scanners(掃描器/篩選器) 是一種提供市場動態篩選功能的介面，可根據特定條件對交易標的進行排名。透過其提供的參數 `scanner_type`、`ascending`、`count` 等，使用者能輕鬆取得如漲幅前五名或成交量前十名的標的清單。此工具有助於投資者快速掌握市場中表現最為顯著的標的，方便後續策略布局。