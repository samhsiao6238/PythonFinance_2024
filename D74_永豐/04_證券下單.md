# 證券下單

_可參考官方 [產業類別與分類碼對照表](https://members.sitca.org.tw/OPF/K0000/files/F/01/%E8%AD%89%E5%88%B8%E4%BB%A3%E7%A2%BC%E7%B7%A8%E7%A2%BC%E5%8E%9F%E5%89%87.doc)_

<br>

## 準備工作

1. 載入環境變數。

    ```python
    import os
    from dotenv import load_dotenv
    load_dotenv()

    api_key=os.environ["API_KEY"]
    secret_key=os.environ["SECRET_KEY"]
    ```

<br>

2. 登入；特別注意，`simulation` 預設為 `True`，測試時使用隱式設定即可。

    ```python
    # 模擬模式
    api = sj.Shioaji(simulation=True)
    api.login(
        api_key=api_key,   
        secret_key=secret_key
    )
    ```

    ![](images/img_14.png)

<br>

## 開始下單

1. 證券下單；再次確認前面步驟的模式參數設定，若要正式下單務必顯式設置為 `False`。

    ```python
    # 股票代碼
    Stock_Symbo = "2330"
    # 商品檔
    contract = api.Contracts.Stocks.TSE[Stock_Symbo]

    # 證券委託單物件
    order = api.Order(
        # 價格
        price=1010,
        # 數量
        quantity=1,
        # 買賣別
        action=sj.constant.Action.Buy,
        # 委託價格類別
        price_type=sj.constant.StockPriceType.LMT,
        # 委託條件
        order_type=sj.constant.OrderType.ROD,
        # 下單帳號
        account=api.stock_account,
    )

    # 下單，傳入商品檔以及合約物件
    trade = api.place_order(contract, order)
    trade
    ```

<br>

2. 商品檔也可表示如下，`Stocks` 屬性涵蓋了所有股票合約而不特定於 `TSE` 或 `OTC` 某個交易所，以嚴謹度來說，當然是儘量縮小範圍為宜，除此並無差異，這裡補充說明。

    ```python
    contract_2890 = api.Contracts.Stocks["2890"]
    ```

<br>

## 輸出說明

_輸出包含 `OrderState.StockOrder`、`Trade` 兩部分_

<br>

1. 第一部分 `OrderState.StockOrder` 輸出說明如下。

    ```bash
    {
        'operation': 
            {
                # 新建訂單
                'op_type': 'New', 
                # `00` 代表成功
                'op_code': '00', 
                # 無額外訊息
                'op_msg': ''
            }, 
        'order': 
            {
                # 內部訂單 ID
                'id': '000003',
                # 序號，通常與 ID 相同 
                'seqno': '000003', 
                # 內部訂單編號
                'ordno': '000002', 
                'account': 
                    {
                        # 帳戶類型，S 表示證券帳戶
                        'account_type': 'S', 
                        'person_id': '',
                        # 券商代號 
                        'broker_id': '9A95',
                        # 帳號
                        'account_id': '3453495',
                        # 是否完成 API 簽署
                        'signed': False
                    }, 
                'action': 'Buy', 
                # 價格
                'price': 1010, 
                # 數量
                'quantity': 1, 
                # 委託條件，Cash 表示現金交易
                'order_cond': 'Cash', 
                # 下單股數類型，Common 表示普通股
                'order_lot': 'Common', 
                'custom_field': '', 
                # 委託單類型，ROD 表示當日有效單
                'order_type': 'ROD', 
                # 價格類型，LMT 表示限價單
                'price_type': 'LMT'
            }, 
        'status': 
            {
                'id': '000003',
                # 交易所時間戳記
                'exchange_ts': 1733876046.713682, 
                'order_quantity': 1, 
                'modified_price': 0, 
                'cancel_quantity': 0,
                # 網頁端 ID，137，用於內部記錄
                'web_id': '137'
            }, 
        'contract': 
            {
                # 商品類型，STK 表示股票
                'security_type': 'STK',
                # 交易所，TSE 表示台灣證券交易所
                'exchange': 'TSE', 
                # 股票代號
                'code': '2330'
            }
    }
    ```

<br>

2. 第二部分 `Trade` 說明如下。

    ```bash
    Trade(
        contract=Stock(exchange=<Exchange.TSE: 'TSE'>, 
        code='2330', 
        symbol='TSE2330', 
        name='台積電', 
        category='24', 
        unit=1000, 
        limit_up=1170.0, 
        limit_down=959.0, 
        reference=1065.0, 
        update_date='2024/12/11', 
        margin_trading_balance=78, 
        day_trade=<DayTrade.OnlyBuy: 'OnlyBuy'>), 
        order=Order(
            action=<Action.Buy: 'Buy'>, 
            price=1010, 
            quantity=1, 
            account=StockAccount(
                person_id='Y120269041', broker_id='9A95', account_id='3453495', username='蕭中柱'
            ), 
            price_type=<StockPriceType.LMT: 'LMT'>, 
            order_type=<OrderType.ROD: 'ROD'>
        ), 
        status=OrderStatus(status=<Status.Failed: 'Failed'>)
    )
    ```

<br>

___

_接續下一個單元_