# 混淆矩陣（Confusion Matrix）

## 說明

1. 混淆矩陣是用於評估 `分類模型` 性能的一種工具，特別適用於 `二元分類` 和 `多類分類` 問題。

2. 混淆矩陣提供了真實類別與模型預測類別之間的比較，並能夠展示模型在哪些類別上表現良好，在哪些類別上容易出錯。

3. 混淆矩陣是一個方陣，其中橫軸表示模型的預測標籤（Predicted Label），縱軸表示真實標籤（True Label）。

4. 在混淆矩陣中，行表示實際類別，列表示模型的預測類別，矩陣中的每個元素 $(i, j)$ 代表真實類別為 $i$ 且預測類別為 $j$ 的樣本數量。

## 混淆矩陣的結構

_對於二元分類問題，混淆矩陣通常是 2x2 的矩陣，結構如下_

![](images/img_20.png)

1. TP（True Positive，真正例）：模型正確地將正例分類為正例。

2. TN（True Negative，真負例）：模型正確地將負例分類為負例。

3. FP（False Positive，假正例）：模型錯誤地將負例分類為正例，又稱為「Type I Error」。

4. FN（False Negative，假負例）：模型錯誤地將正例分類為負例，又稱為「Type II Error」。

## 混淆矩陣的使用

1. 混淆矩陣可以用來計算多種性能指標，如準確率（Accuracy）、精確率（Precision）、召回率（Recall）、F1分數（F1-Score）等。

2. 以下範例使用 Keras 提供的 MNIST 數據集來演示如何構建一個簡單的人工神經網絡（ANN），並使用混淆矩陣來評估模型的性能。

```python
import numpy as np
import matplotlib.pyplot as plt
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense, Flatten
from tensorflow.keras.utils import to_categorical
from tensorflow.keras.datasets import mnist
from sklearn.metrics import confusion_matrix, ConfusionMatrixDisplay

# 加載 MNIST 數據集
(X_train, y_train), (X_test, y_test) = mnist.load_data()

# 數據預處理：將影像數據轉換為浮點數並歸一化
X_train = X_train.astype('float32') / 255
X_test = X_test.astype('float32') / 255

# 將類別標籤進行 One-hot 編碼
y_train = to_categorical(y_train, 10)
y_test = to_categorical(y_test, 10)

# 建立簡單的 ANN 模型
model = Sequential()
# 展平層
model.add(Flatten(input_shape=(28, 28)))
# 第一個隱藏層
model.add(Dense(128, activation='relu'))
# 輸出層
model.add(Dense(10, activation='softmax'))

# 編譯模型
model.compile(
    loss='categorical_crossentropy', 
    optimizer='adam', 
    metrics=['accuracy']
)

# 訓練模型
model.fit(
    X_train, y_train, 
    epochs=10, 
    batch_size=128, 
    verbose=1, 
    validation_data=(X_test, y_test)
)

# 使用測試集進行預測
y_pred = model.predict(X_test)

# 將預測結果轉為類別索引
y_pred_classes = np.argmax(y_pred, axis=1)
# 將真實標籤轉為類別索引
y_true = np.argmax(y_test, axis=1)

# 生成混淆矩陣
cm = confusion_matrix(y_true, y_pred_classes)

# 可視化混淆矩陣
disp = ConfusionMatrixDisplay(confusion_matrix=cm)
disp.plot()
plt.title('混淆矩陣')
plt.show()
```

3. 混淆矩陣。

![](images/img_21.png)


## 混淆矩陣的優點

1. 能夠顯示模型在不同類別上的具體表現。

2. 幫助識別分類錯誤的類別，這有助於調整模型或數據處理流程。

3. 能夠計算其他重要的分類指標，如精確率（Precision）、召回率（Recall）和 F1 分數（F1-Score）。

<br>

___

_END_