# 正則表達式

_Regular Expression，RE_

<br>

## 介紹

1. `正則表達式` 是一種用於 `匹配字串模式` 的語法工具，廣泛應用於 `字串的搜索、替換、解析` 等操作。

<br>

2. Python 提供了內建的 `re` 模組來支援正則表達式操作，使用時必須導入函式庫 `re`。

<br>

3. `正則表達式` 的使用情境很多，例如在自然語言處理任務中用來進行文本清理，在特徵生成任務中提取有價值的信息，在數據分析時用以清洗數據，在網路爬蟲任務中提取文章標題、超連結、圖片 URL 等等；但特別說明，在解析 `HTML` 等複雜結構時，建議使用專門的庫如 `BeautifulSoup` 來確保正確性與可維護性。

<br>

## 簡單範例

1. 使用正則表達用於匹配電子郵件。

    ```python
    import re

    # 定義一個包含電子郵件地址的字串
    text = "請聯繫我們：support@example.com 或 info@sample.org 了解更多資訊。"

    # 正則表達式模式，用來匹配電子郵件地址
    # [a-zA-Z0-9._%+-]+：匹配電子郵件地址的使用者名稱部分，允許字母、數字、點、底線、百分號、加號和減號
    # @：匹配電子郵件地址中的「@」符號
    # [a-zA-Z0-9.-]+：匹配電子郵件的網域名稱，允許字母、數字、點和減號
    # \.[a-zA-Z]{2,}：匹配頂級域名，要求兩個或以上的字母。
    email_pattern = r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'

    # 使用 re.findall() 提取所有匹配的電子郵件地址
    emails = re.findall(email_pattern, text)

    # 結果
    print(emails)
    ```

    _輸出結果_

    ```bash
    ['support@example.com', 'info@sample.org']
    ```

<br>

2. 在構建機器學習模型來分析網頁上的評論時，可使用正則表達式過濾掉不相關的字符、HTML 標籤或其他噪音。

    ```python
    import re

    # 假設有一段含有 HTML 內容的評論
    text = '<p>這是一個很棒的產品！<br>我會再買一次。</p>'

    # 使用正則表達式來去除 HTML 標籤
    clean_text = re.sub(r'<.*?>', '', text)

    print(clean_text)
    ```

    _輸出結果_

    ```bash
    這是一個很棒的產品！我會再買一次。
    ```

<br>

## 常用正則表達式符號

1. `.`：匹配任意單個字元，除換行符。

2. `^`：匹配字串的開頭。

3. `$`：匹配字串的結尾。

4. `*`：匹配前面的字元 0 次或多次。

5. `+`：匹配前面的字元 1 次或多次。

6. `?`：匹配前面的字元 0 次或 1 次。

7. `{n}`：匹配前面的字元恰好 n 次。

8. `{n,}`：匹配前面的字元至少 n 次。

9. `{n,m}`：匹配前面的字元至少 n 次，最多 m 次。

10. `[abc]`：匹配方括號中的任意一個字元。

11. `[^abc]`：匹配不在方括號內的任意字元。

12. `|`：表示邏輯「或」，匹配 `|` 兩邊任意一側的模式。

<br>

## 字元類

1. `\d`：匹配任何數字字元，相當於 `[0-9]`。

2. `\D`：匹配任何非數字字元。

3. `\w`：匹配任何字母數字字元、包括底線，相當於 `[a-zA-Z0-9_]`。

4. `\W`：匹配任何非字母數字字元。

5. `\s`：匹配任何空白字元，如空格、制表符等。

6. `\S`：匹配任何非空白字元。

<br>

## 分組與反向引用

1. `()`：用來進行分組，將匹配的內容捕獲。

2. `\1`, `\2`：反向引用，用於再次匹配已捕獲的子組。

<br>

## `re` 模組常用函數

1. `re.match(pattern, string)`：從字串開頭匹配正則表達式。

2. `re.search(pattern, string)`：在字串中搜尋第一次匹配的模式。

3. `re.findall(pattern, string)`：返回字串中所有非重疊的匹配結果。

4. `re.sub(pattern, repl, string)`：將字串中匹配的部分替換為指定的內容。

5. `re.split(pattern, string)`：使用正則表達式模式分割字串。

<br>

## 範例程式碼與說明

1. 使用 `match()` 函數匹配字串開頭；`re.match()` 只會檢查字串開頭是否匹配。

    ```python
    import re

    pattern = r"Hello"
    _str = "Hello, World!"
    match_obj = re.match(pattern, _str)

    if match_obj:
        print(f"匹配成功！，傳回： {match_obj}")
    else:
        print("匹配失敗！")
    ```

    _結果_

    ```bash
    匹配成功！，傳回： <re.Match object; span=(0, 5), match='Hello'>
    ```

<br>

2. 使用 `search()` 函數搜尋子字串，`re.search()` 可在整個字串中搜尋匹配結果。

    ```python
    import re

    pattern = r"World"
    _str = "Hello, World! Goodbye, World!"
    match_result = re.search(pattern, _str)

    if match_result:
        print(f"找到匹配的子字串在位置 {match_result.start()} 到 {match_result.end()}！")
    else:
        print("未找到匹配的子字串！")
    ```

    _結果_

    ```bash
    找到匹配的子字串在位置 7 到 12！
    ```

<br>

3. 使用 `findall()` 函數找到所有匹配的子字串，`\d+` 表示匹配一個或多個連續的數字字元。

    ```python
    import re

    pattern = r"\d+"
    result = re.findall(pattern, "There are 123 apples and 456 oranges.")
    print(result)
    ```

    _結果_

    ```bash
    ['123', '456']
    ```

<br>

4. 使用 `sub()` 函數替換匹配字串，`re.sub()` 將匹配的內容替換成指定的字串。

    ```python
    import re

    pattern = r"apples"
    replacement = "bananas"
    result = re.sub(pattern, replacement, "There are 123 apples.")
    print(result)
    ```

    _結果_

    ```bash
    There are 123 bananas.
    ```

<br>

5. 從 HTML 中提取超連結，`href="(.+?)"` 捕捉 `href` 屬性中雙引號內的網址。

    ```python
    import re

    html_content = '''<a href="https://www.example1.com">Example 1</a>
                    <a href="https://www.example2.com">Example 2</a>'''

    pattern = r'href="(.+?)"'
    links = re.findall(pattern, html_content)

    for link in links:
        print(link)
    ```

    _結果_

    ```bash
    https://www.example1.com
    https://www.example2.com
    ```

<br>

6. 從 HTML 中提取圖片網址，`src="(.+?)"` 用來匹配 `src` 屬性中的圖片網址。

    ```python
    import re

    html_content = '''<img src="https://www.example.com/image1.jpg">
                    <img src="https://www.example.com/image2.png">'''

    pattern = r'src="(.+?)"'
    images = re.findall(pattern, html_content)

    for image in images:
        print(image)
    ```

    _結果_

    ```bash
    https://www.example.com/image1.jpg
    https://www.example.com/image2.png
    ```

<br>

7. 提取網頁中的電子郵件地址，正則表達式用來匹配符合電子郵件格式的字串。

    ```python
    import re

    text_content = '''Please contact john.doe@example.com for more information.
                    Alternatively, you can reach out to jane.doe@sample.org.'''

    pattern = r'[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}'
    emails = re.findall(pattern, text_content)

    for email in emails:
        print(email)
    ```

    _結果_

    ```bash
    john.doe@example.com
    jane.doe@sample.org
    ```

<br>

8. 刪除 HTML 標籤，`re.sub(r'<[^>]+>', '', html_content)` 用來移除所有 HTML 標籤。

    ```python
    import re

    html_content = '<h1>Title</h1><p>This is a <a href="#">link</a>.</p>'
    cleaned_content = re.sub(r'<[^>]+>', '', html_content)
    print(cleaned_content)
    ```

    _結果_

    ```bash
    TitleThis is a link.
    ```

<br>

___

_END_