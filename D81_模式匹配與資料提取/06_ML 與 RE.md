# ML 與 RE

_使用機器學習模型輔助正則表達式進行資料提取_


## 說明

在資料提取工作中，正則表達式（RE） 非常適合處理結構化和半結構化資料，如特定格式的日期、郵件地址、電話號碼等。然而，當文本數據更加非結構化（如自然語言文本）時，正則表達式可能無法處理複雜的上下文關係。在這些情況下，機器學習模型 可以輔助正則表達式更精確地提取所需的資料，特別是在命名實體識別（Named Entity Recognition, NER）等應用中。

### 1. 何時使用機器學習輔助正則表達式
- 當資料提取涉及更複雜的語言模式或上下文依賴時，如提取人名、地名、組織名稱等。
- 當正則表達式過於繁瑣或難以管理時，可以結合機器學習模型進行初步篩選，然後用正則表達式做精細匹配。

---

### 2. 範例情境：從文本中提取電子郵件地址與人名
在以下範例中，我們將展示如何使用機器學習模型（如 `spaCy` 的命名實體識別模型）來輔助正則表達式提取電子郵件地址與人名。機器學習模型會先進行初步的資料提取，正則表達式則用來進行具體格式的資料過濾。

#### 步驟
1. 使用 `spaCy` 來辨識文本中的人名。
2. 使用正則表達式從文本中提取電子郵件地址。
3. 結合兩者的結果來完成複雜資料的提取。

### 3. 安裝所需套件
我們將使用 `spaCy` 進行命名實體識別，並使用 `re` 來處理正則表達式。

首先，安裝 `spaCy` 並下載一個模型：
```bash
pip install spacy
python -m spacy download en_core_web_sm
```

---

### 4. Python 程式碼範例

```python
import re
import spacy

# 初始化 spaCy 模型
nlp = spacy.load("en_core_web_sm")

# 模擬一段文本，其中包含電子郵件地址與人名
text = """
Please contact John Doe at john.doe@example.com for further information.
Alternatively, you can reach Jane Smith via jane.smith@sample.org.
Thank you!
"""

# 步驟 1：使用正則表達式提取電子郵件地址
email_pattern = r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
emails = re.findall(email_pattern, text)

# 步驟 2：使用 spaCy 模型提取人名
doc = nlp(text)
persons = [ent.text for ent in doc.ents if ent.label_ == "PERSON"]

# 打印結果
print("提取的電子郵件地址：", emails)
print("提取的人名：", persons)

# 結合兩者，進行進階的處理或篩選
for person, email in zip(persons, emails):
    print(f"{person} 的電子郵件是：{email}")
```

---

### 5. 程式碼解釋

1. 正則表達式提取電子郵件
   - 我們使用一個簡單的正則表達式來匹配文本中的電子郵件格式。正則表達式模式 `r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'` 將會匹配大多數標準的電子郵件格式。
   - 使用 `re.findall()` 來抓取所有符合此模式的電子郵件地址。

2. 使用機器學習提取人名
   - `spaCy` 提供了預訓練的命名實體識別（NER）模型。我們加載了 `en_core_web_sm` 模型，這是一個通用的英文模型，能識別文本中的人名、地名、組織名稱等。
   - `doc.ents` 是 `spaCy` 提取出的實體，透過 `ent.label_ == "PERSON"` 我們可以篩選出被標註為人名的實體。

3. 結合結果
   - 我們將正則表達式提取的電子郵件與 NER 提取的人名結合，進一步進行篩選或關聯。這是機器學習與正則表達式結合的典型應用場景。

---

### 6. 擴展與應用

這種方法可以擴展到更多情境：
- 從非結構化文件中提取地址與電話號碼：使用 NER 提取地名，結合正則表達式過濾出電話號碼或地址。
- 分析新聞文章：機器學習模型可以先篩選出關鍵人物、組織，再通過正則表達式過濾其相關資料。
- 日誌檔案分析：結合機器學習與正則表達式篩選特定格式的錯誤或警告訊息。

---

### 7. 總結

通過結合機器學習模型與正則表達式，我們可以處理更為複雜的資料提取需求。正則表達式擅長匹配具體格式的內容，而機器學習模型能捕捉語義層面的訊息。兩者結合可以提升資料提取的準確性與效率，特別是在自然語言處理與非結構化數據的場景下。